(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{8785:function(e,n,t){"use strict";var r=t(5893);n.Z=function(e){var n=e.children,t=e.state,c=e.className,a=void 0===c?"":c,s=e.onClick;return(0,r.jsx)("button",{onClick:s,className:"".concat(a," border-black box-sizing border-[3px] rounded-xl px-[17px] py-[15px] font-semibold text-center leading-none ").concat("solid"===t?"bg-black text-gray-0":""),children:n})}},1932:function(e,n,t){"use strict";var r=t(5893);n.Z=function(e){var n=e.children,t=e.noShadow,c=e.className,a=e.onClick;return(0,r.jsx)("div",{className:"".concat(c," rounded-xl border-4 border-black p-4 ").concat(t?"":"oblique-shadow mr-[8px] mb-[8px]"),onClick:a,children:n})}},490:function(e,n,t){"use strict";var r=t(5893);n.Z=function(){return(0,r.jsxs)("div",{className:"lds-spinner",children:[(0,r.jsx)("div",{}),(0,r.jsx)("div",{}),(0,r.jsx)("div",{}),(0,r.jsx)("div",{}),(0,r.jsx)("div",{}),(0,r.jsx)("div",{}),(0,r.jsx)("div",{}),(0,r.jsx)("div",{}),(0,r.jsx)("div",{}),(0,r.jsx)("div",{}),(0,r.jsx)("div",{}),(0,r.jsx)("div",{})]})}},5919:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return C}});var r=t(5893),c=t(809),a=t.n(c),s=t(2447),i=t(7294),o=t(1122),u=t(5733),l=t.n(u),d=t(3162),p=t(8785),f=t(1932),h=t(4062),x=t(9999),v=t(4121),m=function(e,n){return n.map((function(n,t){return"".concat(e," ").concat(t+1)}))},w=t(490),j=t(6265),g=t(6149);function b(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function y(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?b(Object(t),!0).forEach((function(n){(0,j.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):b(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var k,N={owner:"electinth",repo:"dream-constitution"},Z=function(){var e=(0,s.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=g.v,e.next=3,(0,h.RM)();case 3:e.t1=e.sent,e.t2={auth:e.t1},k=new e.t0(e.t2);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=(0,s.Z)(a().mark((function e(){var n,t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k){e.next=3;break}return e.next=3,Z();case 3:return e.next=5,k.request("GET /repos/{owner}/{repo}/actions/runs",y(y({},N),{},{per_page:5}));case 5:return n=e.sent,t=n.data,e.abrupt("return",t.workflow_runs.map((function(e){var n=e.id,t=e.name,r=e.status,c=e.conclusion,a=e.created_at;return{id:n,name:t,status:r,conclusion:c,createdAt:new Date(a)}})));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=(0,s.Z)(a().mark((function e(n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k){e.next=3;break}return e.next=3,Z();case 3:return e.next=5,k.request("POST /repos/{owner}/{repo}/actions/workflows/{workflow_id}/dispatches",y(y({},N),{},{workflow_id:n,ref:"main"}));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),C=function(){var e=(0,i.useState)(""),n=e[0],t=e[1],c=(0,i.useState)(""),u=c[0],j=c[1],g=(0,i.useState)(!1),b=g[0],y=g[1],k=(0,i.useState)(null),N=k[0],Z=k[1],C=(0,i.useState)([]),P=C[0],S=C[1],E=o.Z.auth();(0,i.useEffect)((function(){Z(E.currentUser),E.currentUser&&O().then(S)}),[E.currentUser]);var D=!n.length||!u.length,A=function(){var e=(0,s.Z)(a().mark((function e(){var n,t,r,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y(!0),e.prev=1,e.next=4,(0,h.Y1)();case 4:return n=e.sent,t="CONstituionLAB_".concat((new Date).toLocaleString("th-TH",{dateStyle:"short"}).split("/").join("_")),r=new(l()),(a=n,a.reduce((function(e,n){if(!n)return e;var t=Object.entries(n),r=t.map((function(e){var n=(0,v.Z)(e,2),t=n[0],r=n[1],c=r.submitAt,a=r.answers,s=r.suggestedOptions,i=r.finalOptions,o=r.feedback;return[t].concat((0,x.Z)(new Date(c).toLocaleString().split(", ")),(0,x.Z)(a),(0,x.Z)(s),(0,x.Z)(i),[o]).join(",")})),c=t[0][1],a=c.answers,s=c.suggestedOptions,i=c.finalOptions,o=["id","date","time"].concat((0,x.Z)(m("answer",a)),(0,x.Z)(m("suggestedOption",s)),(0,x.Z)(m("finalOption",i)),["feedback"]);return[].concat((0,x.Z)(e),[[o].concat((0,x.Z)(r)).join("\n")])}),[])).forEach((function(e,n){return r.file("".concat(t,"/topic-").concat(n+1,".csv"),e)})),e.next=10,r.generateAsync({type:"blob"});case 10:c=e.sent,(0,d.saveAs)(c,"".concat(t,".zip")),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),alert(e.t0);case 17:return e.prev=17,y(!1),e.finish(17);case 20:case"end":return e.stop()}var a}),e,null,[[1,14,17,20]])})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=(0,s.Z)(a().mark((function e(n){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{y(!0),_(n),t=setInterval((0,s.Z)(a().mark((function e(){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O();case 2:r=e.sent,null!==(n=r[0])&&void 0!==n&&n.conclusion&&clearInterval(t),S(r),y(!1);case 6:case"end":return e.stop()}}),e)}))),1e4)}catch(r){alert(r)}case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,r.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:b?(0,r.jsx)(w.Z,{}):(0,r.jsxs)(f.Z,{className:"space-y-4 w-[480px]",children:[(0,r.jsx)("h1",{className:"text-headline-1",children:"Admin"}),N?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h2",{className:"text-headline-2",children:"Participants result"}),(0,r.jsx)(p.Z,{state:"outline",className:"w-full",onClick:A,children:"Export CSV Zip file"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h2",{className:"text-headline-2",children:"Deployment"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,r.jsx)("div",{className:"flex items-center font-bold",children:(0,r.jsx)("a",{href:"https://dream-constitution.web.app/",target:"_blank",rel:"noreferrer",className:"hover:underline",children:"1. Staging"})}),(0,r.jsx)(p.Z,{state:"outline",className:"w-full",onClick:function(){return L("staging.yaml")},children:"Deploy"}),(0,r.jsx)("div",{className:"flex items-center font-bold",children:(0,r.jsx)("a",{href:"https://dream-constitution.web.app/",target:"_blank",rel:"noreferrer",className:"hover:underline",children:"2. Production"})}),(0,r.jsx)(p.Z,{state:"outline",className:"w-full",onClick:function(){return L("production.yaml")},children:"Deploy"})]}),(0,r.jsx)("h3",{className:"underline",children:"History"}),(0,r.jsx)("div",{className:"grid grid-cols-3 gap-2 text-body-2",children:P.map((function(e){var n,t=e.id,c=e.name,a=e.status,s=e.conclusion,i=e.createdAt;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"font-bold",children:null!==c&&void 0!==c&&c.toLowerCase().includes("staging")?"Staging":"Production"},"".concat(t,"-name")),(0,r.jsx)("p",{children:null===(n=s||a)||void 0===n?void 0:n.split("_").join(" ")},"".concat(t,"-con")),(0,r.jsx)("p",{children:i.toLocaleString("TH-th")},"".concat(t,"-create"))]})}))})]}),(0,r.jsx)(p.Z,{state:"solid",className:"w-full",onClick:function(){y(!0),E.signOut().then((function(){Z(null),j("")})).catch((function(e){var n=e.code,t=e.message;return alert("Error ".concat(n,": ").concat(t))})).finally((function(){return y(!1)}))},children:"Logout"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{type:"text",className:"bg-gray-100 rounded-xl w-full p-4",placeholder:"Email",value:n,onChange:function(e){return t(e.target.value)}}),(0,r.jsx)("input",{type:"password",className:"bg-gray-100 rounded-xl w-full p-4",placeholder:"Password",value:u,onChange:function(e){return j(e.target.value)}}),(0,r.jsx)(p.Z,{state:"solid",className:"w-full ".concat(D?"opacity-50":""),onClick:function(){return!D&&(y(!0),void E.signInWithEmailAndPassword(n,u).then(function(){var e=(0,s.Z)(a().mark((function e(n){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.user,Z(t),e.t0=S,e.next=5,O();case 5:e.t1=e.sent,(0,e.t0)(e.t1);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){var n=e.code,t=e.message;return alert("Error ".concat(n,": ").concat(t))})).finally((function(){return y(!1)})))},children:"Log in"})]})]})})}},2347:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return t(5919)}])}},function(e){e.O(0,[504,834,533,774,888,179],(function(){return n=2347,e(e.s=n);var n}));var n=e.O();_N_E=n}]);